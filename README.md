# راهنمای استفاده از پروژه در سرور لوکال

## ابتدا محیط مجازی توسعه env را برای اجرای پروژه ایجاد کنید

### سپس از فایل requirements.txt ابزارهای مورد استفاده را نصب کنید

### برای اجرای پروژه باید فایل main.py را اجرا کرده تا سرور فلسک اجرا شود

### برای مشاهده api های فعال کافی است به فایل flask_server/server.py مراجعه کرده و فانکشن های فعال را مشاهده کنید

## دقت شود که تمامی api ها باید با متد post فراخوانی شوند

## این api ها زمانی کاربرد دارند که RUN_SCHEDULE غیر فعال باشد

<http://127.0.0.1:5000>
که این آدرس برای مطلع شدن از کارکرد سرور استفاده می شود

<http://127.0.0.1:5000/find-sitemap-hrefs>
این آدرس برای استخراج آدرس محصولات با استفاده از site_id استفاده می شود
را باید با استفاده از فرم به api ارسال کرد

<http://127.0.0.1:5000/find-price-title>
این آدرس برای استخراج قیمت و تایتل و لینک تصویر یک محصول از link_id استفاده می شود
link_id را باید با فرم به api ارسال کرد

<http://127.0.0.1:5000/gc-find-price-title>
این آدرس برای استخراج قیمت و تایتل و لینک تصویر یک محصول از درون google web cache و از link_id استفاده می شود
link_id را باید با فرم به api ارسال کرد

<http://127.0.0.1:5000/find-sitemap-hrefs-all>
برای خواندن تمامی سایت مپ ها از تمامی سطرهای موجود در جدول sites استفاده می شود

<http://127.0.0.1:5000/find-price-title-all>
برای استخراج تایتل، قیمت و لینک تصویر تمام محصولات موجود در جدول links استفاده می شود

<http://127.0.0.1:5000/find-price-title-all-non-block>
برای استخراج تایتل، قیمت و لینک تصویر تمام محصولات موجود در جدول links استفاده می شود اما این کار را به صورتی انجام می دهد تا احتمال بلاک شدن از طرف وبسایت پذیرنده به حداقل برسد

<http://127.0.0.1:5000/find-digikala-product-price>
برای یافتن قیمت محصول مورد نظر در سایت دیجیکالا استفاده می شود. محصول مورد نظر را باید به عنوان  product_id یا product_name در فرم به api ارسال کرد

<http://127.0.0.1:5000/find-torob-product-price>
برای یافتن قیمت محصول مورد نظر در سایت ترب استفاده می شود. محصول مورد نظر را باید به عنوان product_id یا product_name در فرم به api ارسال کرد

<http://127.0.0.1:5000/find-emalls-product-price>
برای یافتن قیمت محصول مورد نظر در سایت ایمالز استفاده می شود. محصول مورد نظر را باید به عنوان product_id یا product_name در فرم به api ارسال کرد

<http://127.0.0.1:5000/find-torob-seller-product-title>
برای یافتن نام یک محصول در فروشگاههای دیگر در سایت ترب استفاده می شود. برای ورودی باید یک فیلد با نام product_id را در فرم به api ارسال کرد

<http://127.0.0.1:5000/product-url-pattern>
برای استخراج الگوی لینک محصولات برای یک وبسایت خاص استفاده می شود. در فرم یک site_id گرفته و الگوی لینک را برمی گرداند

<http://127.0.0.1:5000/product-url-pattern_all>
برای دریافت الگوی لینک تمامی وبسایت های موجود در جدول sites مورد استفاده قرار میگیرد

<http://127.0.0.1:5000/read_site_price_title>
برای گرفتن قیمت و تایتل تمامی محصولات مرتبط به یک لینک site خاص استفاده می شود. در فرم ورودی یک آرگومان به نام site_id دریافت می کند

<http://127.0.0.1:5000/extract_all_site_links>
برای گرفتن تمام لینکهای یک سایت استفاده می شود به این صورت که از طریق فرم site_id را گرفته و تمام لینک های سایت مورد نظر را می خواند

<http://127.0.0.1:5000/check-general-pattern>
این api برای به کار می رود تا general pattern را روی یک لینک با parent_selectorی خاص تست کنیم یا اینکه یک product_id را به api بدهیم و ببینیم که آیا تابع عمومی روی آن product_id کار می کند یا خیر.
یا باید یک product_id با فرم به آن ارسال کرد یا اینکه یک product_link به همراه یک parent_class به api ارسال کرد

<http://127.0.0.1:5000/check-custom-pattern>
این api یک product_id گرفته و بر اساس site_id آن بررسی می کند که نوع کراولر آن عمومی است یا خصوصی. اگر عمومی باشد که چیزی را جست و جو نمی کند در غیر اینصورت ماژول خصوصی آنرا پیدا کرده و نتیجه را برمی گرداند. همچنین تابع می تواند به جای product_id یک product_link گرفته و بر اساس دامنه آن بررسی کنه site_url مورد نظر از نوع عمومی است یا خصوصی. اگر خصوصی باشد ماژول خصوصی آنرا پیدا کرده و نتیجه را برمیگرداند

## لینک هایی که در ادامه آمده از کتابخانه requests برای استخراج داده استفاده می کند

<http://127.0.0.1:5000/rfind-sitemap-hrefs>
این آدرس برای استخراج آدرس محصولات با استفاده از site_id استفاده می شود
را باید با استفاده از فرم به api ارسال کرد

<http://127.0.0.1:5000/rfind-price-title>
این آدرس برای استخراج قیمت و تایتل و لینک تصویر یک محصول از link_id استفاده می شود
link_id را باید با فرم به api ارسال کرد

<http://127.0.0.1:5000/rgc-find-price-title>
این آدرس برای استخراج قیمت و تایتل و لینک تصویر یک محصول از درون google web cache و از link_id استفاده می شود
link_id را باید با فرم به api ارسال کرد

<http://127.0.0.1:5000/rread_site_price_title>
برای گرفتن قیمت و تایتل تمامی محصولات مرتبط به یک لینک site خاص استفاده می شود. در فرم ورودی یک آرگومان به نام site_id دریافت می کند

<http://127.0.0.1:5000/rfind-sitemap-hrefs-all>
برای خواندن تمامی سایت مپ ها از تمامی سطرهای موجود در جدول sites استفاده می شود

<http://127.0.0.1:5000/rfind-price-title-all>
برای استخراج تایتل، قیمت و لینک تصویر تمام محصولات موجود در جدول links استفاده می شود

<http://127.0.0.1:5000/rfind-price-title-all-non-block>
برای استخراج تایتل، قیمت و لینک تصویر تمام محصولات موجود در جدول links استفاده می شود اما این کار را به صورتی انجام می دهد تا احتمال بلاک شدن از طرف وبسایت پذیرنده به حداقل برسد

<http://127.0.0.1:5000/rcheck-general-pattern>
این api برای به کار می رود و تا general pattern را روی یک لینک با parent_selectorی خاص تست کنیم یا اینکه یک product_id را به api بدهیم و ببینیم که آیا تابع عمومی روی آن product_id کار می کند یا خیر.
یا باید یک product_id با فرم به آن ارسال کرد یا اینکه یک product_link به همراه یک parent_class به api ارسال کرد. توجه کنید که این کار با استفاده از کتابخانه requests انجام می شود

## این api ها زمانی به کار می روند که RUN_SCHEDULE فعال باشد

<http://127.0.0.1:5000/start>
باعث فعال شدن apscheduler و اجرای جاب ها می شود

<http://127.0.0.1:5000/stop>
اگر apscheduler در حال اجرا باشد، آنرا غیر فعال می کند (نکته بسیار مهم: وقتی apscheduler را با این درخواست غیر فعال می کنیم، بخشی از منابع سیستم آزاد نمی شود. بنابراین توصیه این است که بعد از هر چند بار استفاده از این درخواست برای توقف apscheduler برنامه را دوباره راه اندازی کنید تا از متوقف شدن ناگهانی و کرش کردن سرور جلوگیری شود)

### کافی است بعد از ران کردن سرور فلسک، با یک api tester مثل postman یا thunder client کار را تست کرد
